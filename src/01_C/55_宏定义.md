### 宏定义

`#define`指令可以实现宏定义

宏（英语：Macro）是一种批量处理的称谓。

计算机科学里的宏是一种抽象（Abstraction），它根据一系列预定义的规则替换一定的文本模式。解释器或编译器在遇到宏时会自动进行这一模式替换。对于编译语言，宏展开在编译时发生，进行宏展开的工具常被称为宏展开器。

宏这一术语也常常被用于许多类似的环境中，它们是源自宏展开的概念，这包括键盘宏和宏语言。绝大多数情况下，“宏”这个词的使用暗示着将小命令或动作转化为一系列指令。

> 把参数批量替换到文本中，这种实现通常称为宏（macro）或定义宏 (define macro)

可以通过`#define`来定义宏，规则如下：

```
#define    宏名(记号)    内容
```

比如现在想通过宏定义一个PI：

```c
#define PI 3.1415926
```

使用：

```c
#include <stdio.h>

#define PI 3.1415926

int main() {
    printf("π的值为：%f", PI);   //就像使用变量一样，可以直接将PI放到这个位置
}
```

在编译时，预处理程序会进行宏替换操作，也就是将程序中所有的`PI`全部替换为`3.1415926`，注意这个跟类型无关，是赤裸裸的纯文本替换，也就是相当于把代码修改了，PI那里直接变成`3.1415926`，当然如果你定义为其他任意的内容，同样会替换到那个位置，但是至于替换之后程序还正不正常就不知道了。

```c
#include <stdio.h>

#define M a + b

int main() {
    int a = 10, b = 20;
    printf("%d", M * a);  
}
```

**结果：210**

即

```c
printf("%d", a + b * a);
```

当然任何地方都可以使用宏替换，包括类型，反正最后都会变成被替换的内容：

```c
#define lbwnb long

int main() {
    lbwnb a = 10L;
}
```

当然除了这种简单的替换之外还可以添加参数，就像函数那样：

```c
#include <stdio.h>

#define MUL(x) x * x

int main() {
    printf("%d", MUL(9));
}
```

最后会变成 9 * 9 替换上去，程序运行出来的结果就是81。

直接调函数肯定也是没问题的，就纯替换：

```c
#include <stdio.h>

#define bb(i) printf("我是宏替换的：%d", i);

int main() {
    bb(666);
}
```

在字符串里面加一个宏定义中的参数

```c
#include <stdio.h>

#define bb(str) printf("我是宏替换的："#str" <");  //使用#直接在字符串中进行宏替换，否则默认情况下会被当做一个字符

int main() {
    bb("你看这不就替换了吗");
}
```

当然还可以替换宏中的部分：

```c
#define TEST(n) x##n   //##会使用参数进行拼接

int main() {
    int TEST(1) = 10;   //这里传入1，那么实际上就是被替换为x1
    x1 = 20;   //所以上面其实是int x1 = 10
}
```

宏既然可以定义出来，那么也可以取消定义，可以使用`#undef`来取消已有的宏定义

```c
#define PI 3.14
#undef PI
```

系统也为我们提供了一些预定义的宏：

| 宏名称       | 含义                                        |
| ------------ | ------------------------------------------- |
| _ _ DATE _ _ | 当前的日期，格式为类似 Jun 27 2023 的字符串 |
| _ _ TIME _ _ | 当前的时间，格式为类似 10:23:12 的字符串    |
| _ _ FILE _ _ | 当前源代码文件的名称（含路径）的字符串      |
| _ _ LINE _ _ | 当前所处的行号是多少就替换为多少，整数      |

这里只列出了一部分。